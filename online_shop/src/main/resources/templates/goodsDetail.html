<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en">
    <meta charset="UTF-8">
    <title>阿甲商城学子详情页</title>
    <link rel="stylesheet" href="../static/css/header.css"/>
    <link href="../static/css/pro_details.css" rel="Stylesheet"/>
    <link href="../static/css/animate.css" rel="Stylesheet"/>
    <link rel="stylesheet" href="../static/css/footer.css"/>
    <script src="https://cdn.bootcss.com/qs/6.7.0/qs.min.js"></script>
</head>
<body>
<span id="islogin" style="display: none" th:text='${session.name}'></span>
<!-- 页面顶部-->
<header id="top">
    <div id="logo" class="lf">
        <img class="animated jello" src="../static/images/header/logo.png" alt="logo"/>
    </div>

</header>
<div id="content_box">
    <di><a href="javascript:history.go(-1)">返回主页</a></di>
</div>
<!--产品预览-->
<!--<div id="shop_detail">-->
<!--    &lt;!&ndash; 左侧&ndash;&gt;-->
<!--    <div id="preview" class="lf">-->
<!--        <div id="mediumDiv">-->
<!--            <img id="mImg" src="../static/images/product_detail/product_detail_img15.png"/>-->
<!--        </div>-->

<!--    </div>-->
<!--    &lt;!&ndash; 右侧&ndash;&gt;-->
<!--    <div class="right_detail lf">-->
<!--        &lt;!&ndash; 商品名称&ndash;&gt;-->
<!--        <h1>Lenovo-YOGA 700</h1>-->
<!--        &lt;!&ndash; 商品全称&ndash;&gt;-->
<!--        <h3>(i7-7500U 8G 256GSSD 2G独显 全高清IPS 360°翻转 正版office)</h3>-->
<!--        &lt;!&ndash; 价格部分&ndash;&gt;-->
<!--        <div class="price">-->
<!--            <div id="pro_price"><b>学员售价：</b><span>￥5999.00</span></div>-->
<!--            <div class="promise">-->
<!--                <b>服务承诺：</b>-->
<!--                <span>*退货补运费</span>-->
<!--                <span>*30天无忧退货</span>-->
<!--                <span>*48小时快速退款</span>-->
<!--                <span>*72小时发货</span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; 数量&ndash;&gt;-->
<!--        <p class="accountChose">-->
<!--            <s>数量：</s>-->
<!--            <button class="numberMinus">-</button>-->
<!--            <input type="text" value="1" class="number" id="buy-num">-->
<!--            <button class="numberAdd">+</button>-->
<!--        </p>-->
<!--        &lt;!&ndash; 购买部分&ndash;&gt;-->
<!--        <div class="shops">-->
<!--            <a href="cart.html" class="buy lf" id="buy_now">立即购买</a>-->

<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!-- 品质保障，私人定制等-->
<div id="foot_box">
    <div class="icon1 lf">
        <img src="../static/images/footer/icon1.png" alt=""/>

        <h3>品质保障</h3>
    </div>
    <div class="icon2 lf">
        <img src="../static/images/footer/icon2.png" alt=""/>

        <h3>私人定制</h3>
    </div>
    <div class="icon3 lf">
        <img src="../static/images/footer/icon3.png" alt=""/>

        <h3>学员特供</h3>
    </div>
    <div class="icon4 lf">
        <img src="../static/images/footer/icon4.png" alt=""/>

        <h3>专属特权</h3>
    </div>
</div>
<!-- 页面底部-->
<div class="foot_bj">
    <div id="foot">
        <div class="lf">
            <p class="footer1"><img src="../static/images/footer/logo.png" alt="" class=" footLogo"/></p>
            <p class="footer2"><img src="../static/images/footer/footerFont.png" alt=""/></p>

        </div>
        <div class="foot_left lf" >
            <ul>
                <li><a href="#"><h3>买家帮助</h3></a></li>
                <li><a href="#">新手指南</a></li>
                <li><a href="#">服务保障</a></li>
                <li><a href="#">常见问题</a></li>
            </ul>
            <ul>
                <li><a href="#"><h3>商家帮助</h3></a></li>
                <li><a href="#">商家入驻</a></li>
                <li><a href="#">商家后台</a></li>
            </ul>
            <ul>
                <li><a href="#"><h3>关于我们</h3></a></li>
                <li><a href="#">关于阿甲</a></li>
                <li><a href="#">联系我们</a></li>
                <li>
                    <img src="../static/images/footer/wechat.png" alt=""/>
                    <img src="../static/images/footer/sinablog.png" alt=""/>
                </li>
            </ul>
        </div>
        <div class="service">
            <p>阿甲商城客户端</p>
            <img src="../static/images/footer/ios.png" class="lf">
            <img src="../static/images/footer/android.png" alt="" class="lf"/>
        </div>
        <div class="download">
            <img src="../static/images/footer/erweima.png">
        </div>
        <!-- 页面底部-备案号 #footer -->
        <div class="record">
            &copy;2017 阿甲集团有限公司 版权所有 京ICP证xxxxxxxxxxx
        </div>
    </div>
</div>

<script src="../static/js/jquery-3.1.1.min.js"></script>
<script src="../static/js/index.js"></script>
<!--图片轮播悬停进入详情页效果-->
<script>
    // var speed = 20;
    // var tab = document.getElementById("demo");
    // var tab1 = document.getElementById("demo1");
    // var tab2 = document.getElementById("demo2");
    // tab2.innerHTML = tab1.innerHTML;
    // function Marquee() {
    //     if (tab2.offsetWidth - tab.scrollLeft <= 0)
    //         tab.scrollLeft -= tab1.offsetWidth
    //     else {
    //         tab.scrollLeft++;
    //     }
    // }
    // var MyMar = setInterval(Marquee, speed);
    // tab.onmouseover = function () {
    //     clearInterval(MyMar)
    // };
    // tab.onmouseout = function () {
    //     MyMar = setInterval(Marquee, speed)
    // };
</script>
<!--添加到购物车 立即购买 收藏部分-->
<script type="text/javascript">
    //加入购物车操作
//     var color;
//     var norms;
//     var buyAccount;
//     function getPro(){
//         //颜色取值
//         $("#choose_color input").each(function (i, item) {
//             if ($(this).hasClass("borderChange")) {
//                 color = $(this).val();
//             }
//         })
//         console.log(color)
//         //规格取值
//         $(".avenge").each(function () {
//             if ($(this).hasClass("borderChange")) {
//                 norms = $(this).html();
//             }
//         })
//         console.log(norms)
//         //数量取值
//         buyAccount = $("#buy-num").val();
//         console.log(buyAccount);
//     }
//     $("#add_cart").click(function (e) {
//         e.preventDefault();
//         getPro();
//         //如果未选择，请选择商品信息
//         if (!color || !norms ) {
// //            $("#add_cart").text("加入购物车").css({"background":"#f5f5f5","color":"#000"})
//             alert("请选择商品信息");
//         }else{
//             $(".modal").show();
//             $(".modal_information span").html("是否将您的宝贝加入购物车");
//         }
//         $('.no').click(function(){
//             $('.modal').hide();
//         })
//         var params = {
//             itemColor: color,
//             itemModel: norms,
//             num: buyAccount,
//             //商品id    temId:${item.id}
//         };
//         $.ajax({
//             type: "post",
//             url: "/insertToCart.html",
//             data: params,
//             success: function (data) {
//                 if (data == '200') {
//                     alert("添加购物车成功！");
//                 } else if (data == 500) {
//                     alert("添加购物车失败！");
//                 } else {
//                     alert("您还没登录呢！");
//                     window.location.href = data;
//                 }
//             },
//             error: function (data) {
// //              alert("系统异常！");
//             }
//         });
//     })

</script>
<script>
    $(function () {
        var nav = $("#tab"); //得到导航对象
        var aside = $(".aside_nav");//右侧导航
        var win = $(window); //得到窗口对象
        var sc = $(document);//得到document文档对象。
        win.scroll(function () {
            if (sc.scrollTop() >= 1000) {
                nav.addClass("fixed_tab");
                aside.addClass("fixed_aside");
            }
            else {
                nav.removeClass("fixed_tab");
                aside.removeClass("fixed_aside");
            }
        })

        win.scroll(function () {
            if (sc.scrollTop() >= 60 && sc.scrollTop() < 1000){
                $("#top").addClass("fixed_nav");
            }
            else {
                $("#top").removeClass("fixed_nav");
            }
        })
    //     //介绍区域右侧导航
        $("#iteminfo .right p").click(function () {
            //$(this).addClass("clic").siblings().removeClass("clic");
            $(this).css("background-color", "#0AA1ED").siblings().css("background-color", "#e8e8e8");
            $(this).find("a").css("color", "#fff").parent().siblings().find("a").css("color", "#828282")
        })
        /**选择商品进行添加 悬停效果**/
        $(".avenge").mouseover(function () {
            $(this).css({"border": "1px solid #0AA1ED", "color": "#0AA1ED"});
        }).mouseout(function () {
            $(this).css({"border": "1px solid #666", "color": "#666"})
        })
        /**数量添加**/
        var n = $("#buy-num").val() * 1;
        $(".numberMinus").click(function () {
            if (n >= 1) {
                $("#buy-num").val(n -= 1);
            }
        })
        $(".numberAdd").click(function () {
            $("#buy-num").val(n += 1);
        })

        /**ajax提交**/
        // $(".avenge").each(function (i, item) {
        //     $(this).click(function (norms) {
        //         $(this).addClass("borderChange")
        //         if ($(this).siblings().addClass("borderChange")) {
        //             $(this).siblings().removeClass("borderChange")
        //         }
        //         //规格选择
        //         var norms = $(this).html();
        //         console.log(norms)
        //     })
        // })
        //颜色选择
        $("#choose_color input").each(function (i, item) {
            $(this).click(function () {
                $(this).addClass("borderChange")
                if ($(this).siblings().addClass("borderChange")) {
                    $(this).siblings().removeClass("borderChange")
                }
                var color = $(this).val();
                console.log(color)
            })
        })
        //数量选择
        $(".accountChose").click(function () {
            var buyAccount = $("#buy-num").val();
            console.log(buyAccount);
        })

        /*立即购买*/
//         $("#buy_now").click(function (e) {
//             //如果未选择，请选择商品信息
//             if (color == undefined && norms == undefined) {
// //            $("#add_cart").text("加入购物车").css({"background":"#f5f5f5","color":"#000"})
//                 alert("请选择商品信息");
//             }else{
//                 location.href="cart.html";
//             }
//             e.preventDefault();
//             var color = $("#choose_color input.borderChange").val();
//             var model = $("#choose_model span.borderChange").html();
//             var num = $("#buy-num").val();
//             // 后台需要的参数
//             // var url = '/toOrder/'+${item.id}+'.html?&num='+num+'&itemColor='+color+'&itemModel='+model;
// //             window.location.href = url;
//         })
    })
</script>
<!--图片效果-->
<script>
    $("#mImg").hover(function (){
        $(this).addClass("animated pulse");
    }, function (){
        $(this).removeClass("animated pulse");
    });
</script>
<script>
    $('#icon_list>li').click(function(){
        $(this).children('img').css('border','1px solid #CECFCE');
        var address=$(this).children().attr('src');
        console.log(address);
        var newaddress=address.slice(0,-4);
        var bigaddress=newaddress+'big.png';
        $('#mImg').attr('src',bigaddress);
        $(this).siblings().children('img').css('border','');
    })
</script>
<script>

    // var id = location.pathname.match(/[^(\/goods\/)]/g)[0];
    var id = sessionStorage.getItem("goodsId");
    $.ajax({
        type: "get",
        url:"/goods/"+id,
        data:{},
        async: false,
        success:function (data) {

            var str = "<div id='shop_detail'>" +
                "    <div id='preview' class='lf'>" +
                "        <div id='mediumDiv'>" +
                "            <img id='mImg' src="+data.goodsimagename+"/>" +
                "        </div>" +
                "    </div>" +
                "    <div class='right_detail lf'>" +
                "        <h1>"+data.goodsname+"</h1>" +
                "        <h3>"+data.goodsdescript+"</h3>" +
                "        <div class='price'>" +
                "            <div id='pro_price'><b>学员售价：</b><span>￥"+data.goodsunitprice+"</span></div>" +
                "            <div class='promise'>" +
                "                <b>服务承诺：</b>" +
                "                <span>*退货补运费</span>" +
                "                <span>*30天无忧退货</span>" +
                "                <span>*48小时快速退款</span>" +
                "                <span>*72小时发货</span>" +
                "            </div>" +
                "        </div>" +
                "        <p class='accountChose'>" +
                "            <s>数量：</s>" +
                "            <button class='numberMinus'>-</button>" +
                "            <input type='text' value='1' class='number' id='buy-num'>" +
                "            <button class='numberAdd'>+</button>" +
                "        </p>" +
                "       <a class='shop lf' id='add_cart'onclick='addCart("+data.goodsid+")'>购物车</a>"+
                "        <div class='shops'>" +
                "            <a class='buy lf' id='buy_now' onclick='buy("+data.sellcount+")'>立即购买</a>" +
                "        </div>" +
                "    </div>" +
                "</div>";
            $("#content_box").append(str);
        }
    })

</script>
<script>

    function buy(count) {
        var buyNum =  $('#buy-num').val();
        var goodCount = count; //库存
        var islogin = document.getElementById("islogin");
        var add_num = localStorage.getItem("add_num");
        var goodsList = [id];
        if(buyNum <= goodCount){
            if (islogin !== null){
                if (add_num !== 0 && add_num !== null){
                    //跳转支付页面（二维码。面部，两个按钮，点面部h5调用摄像头，然后做个假动作，ok）
                    //产生订单（订单内容），订单表感觉得重写，订单表和订单详情表为什么要分成两个表。想一下。
                    $.ajax({
                        type: "POST",
                        url: "/order/create",
                        data: {"goodsList": JSON.stringify(goodsList)},
                        traditional:true,
                        success: function (data) {
                            window.location.href = "/order/toPayPage";
                        },
                        error: function (xhr, textStatus, errorThrown) {
                            /*错误信息处理*/
                            alert("进入error---");
                            alert("状态码："+xhr.status);
                            alert("状态:"+xhr.readyState);//当前状态,0-未初始化，1-正在载入，2-已经载入，3-数据进行交互，4-完成。
                            alert("错误信息:"+xhr.statusText );
                            alert("返回响应信息："+xhr.responseText );//这里是详细的信息
                            alert("请求状态："+textStatus);
                            alert(errorThrown);
                            alert("请求失败");
                        }
                    })
                }else {
                    window.alert("您还未设置收货地址！");
                    window.location.href = "/address/";
                }

            }else {
                window.alert("您还未登录，请先登录后再购买");
                window.location.href = "/user/login";
            }
        }else{
            window.alert("库存不足，请重新选择");
        }

    }
     cartList = JSON.parse(localStorage.getItem("cartList")) || [];
    function addCart() {
        cartList.push(id);
        localStorage.setItem("cartList",JSON.stringify(cartList));
        window.alert("添加购物车成功");
        var cartBtn = document.getElementById("add_cart");
        cartBtn.innerHTML ="<a class='shop lf' id='cancel_cart'onclick='cancelCart()'>已加入</a>";
    }
    //取消加入购物车
    function cancelCart(goodsid) {
        cartList.pop();
        localStorage.setItem("cartList",JSON.stringify(cartList));
        var cartBtn = document.getElementById("cancel_cart");
        cartBtn.innerHTML = "<a class='shop lf' id='add_cart'onclick='addCart()'>购物车</a>";
    }
</script>
//前台获取购买数量 var buyNum =  $('#buy-num').innerText;
//判断是否登录if ( session === null 或其他状态){window.alert= "没登陆"，window。location.href = "/user/login"}else{
//是否有设置过收货地址if(controller->showAll（）->返回的List的数量==0){跳转/address/}else{}}
</body>
</html>